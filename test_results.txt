
> backend@1.0.0 test
> NODE_OPTIONS=--experimental-vm-modules jest --runInBand

(node:18628) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
FAIL tests/marketplace_interaction.test.ts
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (6) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      [dotenv@17.2.3] injecting env (0) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  ‚óè Marketplace Interaction Endpoints ‚Ä∫ POST /api/listings/:id/purchase ‚Ä∫ should purchase a listing successfully using wallet

    PrismaClientKnownRequestError: 
    Invalid `prisma.user.deleteMany()` invocation in
    /home/bytesage/campus-swap/backend/tests/marketplace_interaction.test.ts:24:27

      21 await prisma.listingImage.deleteMany();
      22 await prisma.listing.deleteMany();
      23 await prisma.wallet.deleteMany();
    ‚Üí 24 await prisma.user.deleteMany(
    Foreign key constraint violated on the constraint: `Verification_userId_fkey`

      22 |         await prisma.listing.deleteMany();
      23 |         await prisma.wallet.deleteMany();
    > 24 |         await prisma.user.deleteMany();
         |         ^
      25 |
      26 |         const seller = await prisma.user.create({
      27 |             data: {

      at qr.handleRequestError (node_modules/@prisma/client/src/runtime/RequestHandler.ts:228:13)
      at qr.handleAndLogRequestError (node_modules/@prisma/client/src/runtime/RequestHandler.ts:174:12)
      at qr.request (node_modules/@prisma/client/src/runtime/RequestHandler.ts:143:12)
      at a (node_modules/@prisma/client/src/runtime/getPrismaClient.ts:805:24)
      at Object.<anonymous> (tests/marketplace_interaction.test.ts:24:9)

  ‚óè Marketplace Interaction Endpoints ‚Ä∫ POST /api/listings/:id/purchase ‚Ä∫ should fail if balance is insufficient

    PrismaClientKnownRequestError: 
    Invalid `prisma.user.deleteMany()` invocation in
    /home/bytesage/campus-swap/backend/tests/marketplace_interaction.test.ts:24:27

      21 await prisma.listingImage.deleteMany();
      22 await prisma.listing.deleteMany();
      23 await prisma.wallet.deleteMany();
    ‚Üí 24 await prisma.user.deleteMany(
    Foreign key constraint violated on the constraint: `Verification_userId_fkey`

      22 |         await prisma.listing.deleteMany();
      23 |         await prisma.wallet.deleteMany();
    > 24 |         await prisma.user.deleteMany();
         |         ^
      25 |
      26 |         const seller = await prisma.user.create({
      27 |             data: {

      at qr.handleRequestError (node_modules/@prisma/client/src/runtime/RequestHandler.ts:228:13)
      at qr.handleAndLogRequestError (node_modules/@prisma/client/src/runtime/RequestHandler.ts:174:12)
      at qr.request (node_modules/@prisma/client/src/runtime/RequestHandler.ts:143:12)
      at a (node_modules/@prisma/client/src/runtime/getPrismaClient.ts:805:24)
      at Object.<anonymous> (tests/marketplace_interaction.test.ts:24:9)

  ‚óè Marketplace Interaction Endpoints ‚Ä∫ PATCH /api/listings/:id/status ‚Ä∫ should update listing status by seller

    PrismaClientKnownRequestError: 
    Invalid `prisma.user.deleteMany()` invocation in
    /home/bytesage/campus-swap/backend/tests/marketplace_interaction.test.ts:24:27

      21 await prisma.listingImage.deleteMany();
      22 await prisma.listing.deleteMany();
      23 await prisma.wallet.deleteMany();
    ‚Üí 24 await prisma.user.deleteMany(
    Foreign key constraint violated on the constraint: `Verification_userId_fkey`

      22 |         await prisma.listing.deleteMany();
      23 |         await prisma.wallet.deleteMany();
    > 24 |         await prisma.user.deleteMany();
         |         ^
      25 |
      26 |         const seller = await prisma.user.create({
      27 |             data: {

      at qr.handleRequestError (node_modules/@prisma/client/src/runtime/RequestHandler.ts:228:13)
      at qr.handleAndLogRequestError (node_modules/@prisma/client/src/runtime/RequestHandler.ts:174:12)
      at qr.request (node_modules/@prisma/client/src/runtime/RequestHandler.ts:143:12)
      at a (node_modules/@prisma/client/src/runtime/getPrismaClient.ts:805:24)
      at Object.<anonymous> (tests/marketplace_interaction.test.ts:24:9)

  ‚óè Marketplace Interaction Endpoints ‚Ä∫ PATCH /api/listings/:id/status ‚Ä∫ should fail if update attempted by non-seller

    PrismaClientKnownRequestError: 
    Invalid `prisma.user.deleteMany()` invocation in
    /home/bytesage/campus-swap/backend/tests/marketplace_interaction.test.ts:24:27

      21 await prisma.listingImage.deleteMany();
      22 await prisma.listing.deleteMany();
      23 await prisma.wallet.deleteMany();
    ‚Üí 24 await prisma.user.deleteMany(
    Foreign key constraint violated on the constraint: `Verification_userId_fkey`

      22 |         await prisma.listing.deleteMany();
      23 |         await prisma.wallet.deleteMany();
    > 24 |         await prisma.user.deleteMany();
         |         ^
      25 |
      26 |         const seller = await prisma.user.create({
      27 |             data: {

      at qr.handleRequestError (node_modules/@prisma/client/src/runtime/RequestHandler.ts:228:13)
      at qr.handleAndLogRequestError (node_modules/@prisma/client/src/runtime/RequestHandler.ts:174:12)
      at qr.request (node_modules/@prisma/client/src/runtime/RequestHandler.ts:143:12)
      at a (node_modules/@prisma/client/src/runtime/getPrismaClient.ts:805:24)
      at Object.<anonymous> (tests/marketplace_interaction.test.ts:24:9)

  ‚óè Marketplace Interaction Endpoints ‚Ä∫ POST /api/listings/:id/reserve ‚Ä∫ should reserve a listing

    PrismaClientKnownRequestError: 
    Invalid `prisma.user.deleteMany()` invocation in
    /home/bytesage/campus-swap/backend/tests/marketplace_interaction.test.ts:24:27

      21 await prisma.listingImage.deleteMany();
      22 await prisma.listing.deleteMany();
      23 await prisma.wallet.deleteMany();
    ‚Üí 24 await prisma.user.deleteMany(
    Foreign key constraint violated on the constraint: `Verification_userId_fkey`

      22 |         await prisma.listing.deleteMany();
      23 |         await prisma.wallet.deleteMany();
    > 24 |         await prisma.user.deleteMany();
         |         ^
      25 |
      26 |         const seller = await prisma.user.create({
      27 |             data: {

      at qr.handleRequestError (node_modules/@prisma/client/src/runtime/RequestHandler.ts:228:13)
      at qr.handleAndLogRequestError (node_modules/@prisma/client/src/runtime/RequestHandler.ts:174:12)
      at qr.request (node_modules/@prisma/client/src/runtime/RequestHandler.ts:143:12)
      at a (node_modules/@prisma/client/src/runtime/getPrismaClient.ts:805:24)
      at Object.<anonymous> (tests/marketplace_interaction.test.ts:24:9)

FAIL tests/review.test.ts
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (6) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      [dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      [dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  ‚óè Review & Reputation Endpoints ‚Ä∫ POST /api/transactions/:id/review ‚Ä∫ should submit a review for a transaction

    PrismaClientKnownRequestError: 
    Invalid `prisma.user.deleteMany()` invocation in
    /home/bytesage/campus-swap/backend/tests/review.test.ts:21:27

      18 await prisma.transaction.deleteMany();
      19 await prisma.listing.deleteMany();
      20 await prisma.wallet.deleteMany();
    ‚Üí 21 await prisma.user.deleteMany(
    Foreign key constraint violated on the constraint: `Verification_userId_fkey`

      19 |         await prisma.listing.deleteMany();
      20 |         await prisma.wallet.deleteMany();
    > 21 |         await prisma.user.deleteMany();
         |         ^
      22 |
      23 |         const seller = await prisma.user.create({
      24 |             data: {

      at qr.handleRequestError (node_modules/@prisma/client/src/runtime/RequestHandler.ts:228:13)
      at qr.handleAndLogRequestError (node_modules/@prisma/client/src/runtime/RequestHandler.ts:174:12)
      at qr.request (node_modules/@prisma/client/src/runtime/RequestHandler.ts:143:12)
      at a (node_modules/@prisma/client/src/runtime/getPrismaClient.ts:805:24)
      at Object.<anonymous> (tests/review.test.ts:21:9)

  ‚óè Review & Reputation Endpoints ‚Ä∫ POST /api/transactions/:id/review ‚Ä∫ should fail if rating is invalid

    PrismaClientKnownRequestError: 
    Invalid `prisma.user.deleteMany()` invocation in
    /home/bytesage/campus-swap/backend/tests/review.test.ts:21:27

      18 await prisma.transaction.deleteMany();
      19 await prisma.listing.deleteMany();
      20 await prisma.wallet.deleteMany();
    ‚Üí 21 await prisma.user.deleteMany(
    Foreign key constraint violated on the constraint: `Verification_userId_fkey`

      19 |         await prisma.listing.deleteMany();
      20 |         await prisma.wallet.deleteMany();
    > 21 |         await prisma.user.deleteMany();
         |         ^
      22 |
      23 |         const seller = await prisma.user.create({
      24 |             data: {

      at qr.handleRequestError (node_modules/@prisma/client/src/runtime/RequestHandler.ts:228:13)
      at qr.handleAndLogRequestError (node_modules/@prisma/client/src/runtime/RequestHandler.ts:174:12)
      at qr.request (node_modules/@prisma/client/src/runtime/RequestHandler.ts:143:12)
      at a (node_modules/@prisma/client/src/runtime/getPrismaClient.ts:805:24)
      at Object.<anonymous> (tests/review.test.ts:21:9)

  ‚óè Review & Reputation Endpoints ‚Ä∫ GET /api/users/:id/reviews ‚Ä∫ should get reviews for a user

    PrismaClientKnownRequestError: 
    Invalid `prisma.user.deleteMany()` invocation in
    /home/bytesage/campus-swap/backend/tests/review.test.ts:21:27

      18 await prisma.transaction.deleteMany();
      19 await prisma.listing.deleteMany();
      20 await prisma.wallet.deleteMany();
    ‚Üí 21 await prisma.user.deleteMany(
    Foreign key constraint violated on the constraint: `Verification_userId_fkey`

      19 |         await prisma.listing.deleteMany();
      20 |         await prisma.wallet.deleteMany();
    > 21 |         await prisma.user.deleteMany();
         |         ^
      22 |
      23 |         const seller = await prisma.user.create({
      24 |             data: {

      at qr.handleRequestError (node_modules/@prisma/client/src/runtime/RequestHandler.ts:228:13)
      at qr.handleAndLogRequestError (node_modules/@prisma/client/src/runtime/RequestHandler.ts:174:12)
      at qr.request (node_modules/@prisma/client/src/runtime/RequestHandler.ts:143:12)
      at a (node_modules/@prisma/client/src/runtime/getPrismaClient.ts:805:24)
      at Object.<anonymous> (tests/review.test.ts:21:9)

  ‚óè Review & Reputation Endpoints ‚Ä∫ GET /api/users/:id/rating-summary ‚Ä∫ should get rating summary for a user

    PrismaClientKnownRequestError: 
    Invalid `prisma.user.deleteMany()` invocation in
    /home/bytesage/campus-swap/backend/tests/review.test.ts:21:27

      18 await prisma.transaction.deleteMany();
      19 await prisma.listing.deleteMany();
      20 await prisma.wallet.deleteMany();
    ‚Üí 21 await prisma.user.deleteMany(
    Foreign key constraint violated on the constraint: `Verification_userId_fkey`

      19 |         await prisma.listing.deleteMany();
      20 |         await prisma.wallet.deleteMany();
    > 21 |         await prisma.user.deleteMany();
         |         ^
      22 |
      23 |         const seller = await prisma.user.create({
      24 |             data: {

      at qr.handleRequestError (node_modules/@prisma/client/src/runtime/RequestHandler.ts:228:13)
      at qr.handleAndLogRequestError (node_modules/@prisma/client/src/runtime/RequestHandler.ts:174:12)
      at qr.request (node_modules/@prisma/client/src/runtime/RequestHandler.ts:143:12)
      at a (node_modules/@prisma/client/src/runtime/getPrismaClient.ts:805:24)
      at Object.<anonymous> (tests/review.test.ts:21:9)

FAIL tests/wallet.test.ts
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (6) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      [dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      [dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  ‚óè Wallet & Payment Endpoints ‚Ä∫ POST /api/payment/deposit ‚Ä∫ should initialize a paystack deposit

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

      77 |             // Since we use external API, we expect a successful response from our controller
      78 |             // which handles the axios call to Paystack.
    > 79 |             expect(res.status).toBe(200);
         |                                ^
      80 |             expect(res.body.status).toBe(true);
      81 |             expect(res.body.data).toHaveProperty('authorization_url');
      82 |         });

      at Object.<anonymous> (tests/wallet.test.ts:79:32)

  ‚óè Wallet & Payment Endpoints ‚Ä∫ POST /api/payment/webhook ‚Ä∫ should handle successful paystack payment

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

      107 |                 .send(payload);
      108 |
    > 109 |             expect(res.status).toBe(200);
          |                                ^
      110 |
      111 |             // Verify balance update
      112 |             const wallet = await prisma.wallet.findUnique({ where: { userId } });

      at Object.<anonymous> (tests/wallet.test.ts:109:32)

  ‚óè Wallet & Payment Endpoints ‚Ä∫ POST /api/payment/webhook ‚Ä∫ should fail with invalid signature

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 404

      120 |                 .send({ event: 'charge.success' });
      121 |
    > 122 |             expect(res.status).toBe(400);
          |                                ^
      123 |         });
      124 |     });
      125 | });

      at Object.<anonymous> (tests/wallet.test.ts:122:32)

PASS tests/auth.test.ts
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (6) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      [dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      [INFO] [2026-01-02T15:04:17.418Z] User Registration Attempt {
        "email": "test@unn.edu.ng"
      }

      at Object.info (src/utils/logger.ts:3:17)

    console.log
      [INFO] [2026-01-02T15:04:17.596Z] User Registered Successfully {
        "userId": "3e82e18e-db9a-4a66-bbeb-41ff9002a67f"
      }

      at Object.info (src/utils/logger.ts:3:17)

    console.error
      [ERROR] [2026-01-02T15:04:17.608Z] Register Controller Error [
        {
          "origin": "string",
          "code": "invalid_format",
          "format": "email",
          "pattern": "/^(?!\\.)(?!.*\\.\\.)([A-Za-z0-9_'+\\-\\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\\-]*\\.)+[A-Za-z]{2,}$/",
          "path": [
            "email"
          ],
          "message": "Invalid email format"
        }
      ]

      4 |     },
      5 |     error: (message: string, error?: any) => {
    > 6 |         console.error(`[ERROR] [${new Date().toISOString()}] ${message}`, error?.message || error || '');
        |                 ^
      7 |         if (error?.stack) console.error(error.stack);
      8 |     },
      9 |     warn: (message: string, context?: any) => {

      at Object.error (src/utils/logger.ts:6:17)
      at handleControllerError (src/controllers/authController.ts:12:12)
      at register (src/controllers/authController.ts:63:16)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/body-parser/lib/read.js:172:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

    console.error
      ZodError: [
        {
          "origin": "string",
          "code": "invalid_format",
          "format": "email",
          "pattern": "/^(?!\\.)(?!.*\\.\\.)([A-Za-z0-9_'+\\-\\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\\-]*\\.)+[A-Za-z]{2,}$/",
          "path": [
            "email"
          ],
          "message": "Invalid email format"
        }
      ]
          at register (/home/bytesage/campus-swap/backend/src/controllers/authController.ts:24:46)
          at Layer.handleRequest (/home/bytesage/campus-swap/backend/node_modules/router/lib/layer.js:152:17)
          at next (/home/bytesage/campus-swap/backend/node_modules/router/lib/route.js:157:13)
          at Route.dispatch (/home/bytesage/campus-swap/backend/node_modules/router/lib/route.js:117:3)
          at handle (/home/bytesage/campus-swap/backend/node_modules/router/index.js:435:11)
          at Layer.handleRequest (/home/bytesage/campus-swap/backend/node_modules/router/lib/layer.js:152:17)
          at /home/bytesage/campus-swap/backend/node_modules/router/index.js:295:15
          at processParams (/home/bytesage/campus-swap/backend/node_modules/router/index.js:582:12)
          at next (/home/bytesage/campus-swap/backend/node_modules/router/index.js:291:5)
          at Function.handle (/home/bytesage/campus-swap/backend/node_modules/router/index.js:186:3)
          at router (/home/bytesage/campus-swap/backend/node_modules/router/index.js:60:12)
          at Layer.handleRequest (/home/bytesage/campus-swap/backend/node_modules/router/lib/layer.js:152:17)
          at trimPrefix (/home/bytesage/campus-swap/backend/node_modules/router/index.js:342:13)
          at /home/bytesage/campus-swap/backend/node_modules/router/index.js:297:9
          at processParams (/home/bytesage/campus-swap/backend/node_modules/router/index.js:582:12)
          at next (/home/bytesage/campus-swap/backend/node_modules/router/index.js:291:5)
          at /home/bytesage/campus-swap/backend/node_modules/body-parser/lib/read.js:172:5
          at AsyncResource.runInAsyncScope (node:async_hooks:214:14)
          at invokeCallback (/home/bytesage/campus-swap/backend/node_modules/raw-body/index.js:238:16)
          at done (/home/bytesage/campus-swap/backend/node_modules/raw-body/index.js:227:7)
          at IncomingMessage.onEnd (/home/bytesage/campus-swap/backend/node_modules/raw-body/index.js:287:7)
          at IncomingMessage.emit (node:events:519:28)
          at endReadableNT (node:internal/streams/readable:1698:12)
          at processTicksAndRejections (node:internal/process/task_queues:90:21)

       5 |     error: (message: string, error?: any) => {
       6 |         console.error(`[ERROR] [${new Date().toISOString()}] ${message}`, error?.message || error || '');
    >  7 |         if (error?.stack) console.error(error.stack);
         |                                   ^
       8 |     },
       9 |     warn: (message: string, context?: any) => {
      10 |         console.warn(`[WARN] [${new Date().toISOString()}] ${message}`, context ? JSON.stringify(context, null, 2) : '');

      at Object.error (src/utils/logger.ts:7:35)
      at handleControllerError (src/controllers/authController.ts:12:12)
      at register (src/controllers/authController.ts:63:16)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/body-parser/lib/read.js:172:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

    console.log
      [INFO] [2026-01-02T15:04:17.628Z] User Registration Attempt {
        "email": "test@unn.edu.ng"
      }

      at Object.info (src/utils/logger.ts:3:17)

    console.warn
      [WARN] [2026-01-02T15:04:17.635Z] Registration Failed: User exists {
        "email": "test@unn.edu.ng"
      }

       8 |     },
       9 |     warn: (message: string, context?: any) => {
    > 10 |         console.warn(`[WARN] [${new Date().toISOString()}] ${message}`, context ? JSON.stringify(context, null, 2) : '');
         |                 ^
      11 |     }
      12 | };
      13 |

      at Object.warn (src/utils/logger.ts:10:17)
      at register (src/controllers/authController.ts:31:20)

    console.log
      [INFO] [2026-01-02T15:04:17.643Z] User Login Attempt {
        "email": "test@unn.edu.ng"
      }

      at Object.info (src/utils/logger.ts:3:17)

    console.log
      [INFO] [2026-01-02T15:04:17.769Z] User Logged In Successfully {
        "userId": "3e82e18e-db9a-4a66-bbeb-41ff9002a67f"
      }

      at Object.info (src/utils/logger.ts:3:17)

    console.log
      [INFO] [2026-01-02T15:04:17.776Z] User Login Attempt {
        "email": "test@unn.edu.ng"
      }

      at Object.info (src/utils/logger.ts:3:17)

    console.warn
      [WARN] [2026-01-02T15:04:17.894Z] Login Failed: Invalid password {
        "email": "test@unn.edu.ng"
      }

       8 |     },
       9 |     warn: (message: string, context?: any) => {
    > 10 |         console.warn(`[WARN] [${new Date().toISOString()}] ${message}`, context ? JSON.stringify(context, null, 2) : '');
         |                 ^
      11 |     }
      12 | };
      13 |

      at Object.warn (src/utils/logger.ts:10:17)
      at login (src/controllers/authController.ts:82:20)

    console.log
      [INFO] [2026-01-02T15:04:17.899Z] User Login Attempt {
        "email": "test@unn.edu.ng"
      }

      at Object.info (src/utils/logger.ts:3:17)

    console.log
      [INFO] [2026-01-02T15:04:18.025Z] User Logged In Successfully {
        "userId": "3e82e18e-db9a-4a66-bbeb-41ff9002a67f"
      }

      at Object.info (src/utils/logger.ts:3:17)

    console.log
      [INFO] [2026-01-02T15:04:18.155Z] Profile Updated {
        "userId": "3e82e18e-db9a-4a66-bbeb-41ff9002a67f"
      }

      at Object.info (src/utils/logger.ts:3:17)

PASS tests/marketplace.test.ts
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (6) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      [INFO] [2026-01-02T15:04:18.874Z] Creating Listing {
        "sellerId": "2afe4e14-b62c-4c9b-b999-10167b7cd54e",
        "title": "Test Textbook"
      }

      at Object.info (src/utils/logger.ts:3:17)

    console.log
      [INFO] [2026-01-02T15:04:18.904Z] Listing Created Successfully {
        "listingId": "a855c557-d40b-4ed2-8c59-8107c176ebbe"
      }

      at Object.info (src/utils/logger.ts:3:17)

    console.error
      [ERROR] [2026-01-02T15:04:18.936Z] CreateListing Controller Error [
        {
          "origin": "string",
          "code": "too_small",
          "minimum": 3,
          "inclusive": true,
          "path": [
            "title"
          ],
          "message": "Too small: expected string to have >=3 characters"
        },
        {
          "expected": "string",
          "code": "invalid_type",
          "path": [
            "description"
          ],
          "message": "Invalid input: expected string, received undefined"
        },
        {
          "expected": "string",
          "code": "invalid_type",
          "path": [
            "price"
          ],
          "message": "Invalid input: expected string, received undefined"
        },
        {
          "expected": "string",
          "code": "invalid_type",
          "path": [
            "category"
          ],
          "message": "Invalid input: expected string, received undefined"
        },
        {
          "code": "invalid_value",
          "values": [
            "NEW",
            "USED",
            "FAIR"
          ],
          "path": [
            "condition"
          ],
          "message": "Invalid option: expected one of \"NEW\"|\"USED\"|\"FAIR\""
        }
      ]

      4 |     },
      5 |     error: (message: string, error?: any) => {
    > 6 |         console.error(`[ERROR] [${new Date().toISOString()}] ${message}`, error?.message || error || '');
        |                 ^
      7 |         if (error?.stack) console.error(error.stack);
      8 |     },
      9 |     warn: (message: string, context?: any) => {

      at Object.error (src/utils/logger.ts:6:17)
      at handleControllerError (src/controllers/listingController.ts:9:12)
      at createListing (src/controllers/listingController.ts:50:16)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at multerMiddleware (node_modules/multer/lib/make-middleware.js:19:41)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at protect (src/routes/listingRoutes.ts:27:9)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/body-parser/lib/read.js:172:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

    console.error
      ZodError: [
        {
          "origin": "string",
          "code": "too_small",
          "minimum": 3,
          "inclusive": true,
          "path": [
            "title"
          ],
          "message": "Too small: expected string to have >=3 characters"
        },
        {
          "expected": "string",
          "code": "invalid_type",
          "path": [
            "description"
          ],
          "message": "Invalid input: expected string, received undefined"
        },
        {
          "expected": "string",
          "code": "invalid_type",
          "path": [
            "price"
          ],
          "message": "Invalid input: expected string, received undefined"
        },
        {
          "expected": "string",
          "code": "invalid_type",
          "path": [
            "category"
          ],
          "message": "Invalid input: expected string, received undefined"
        },
        {
          "code": "invalid_value",
          "values": [
            "NEW",
            "USED",
            "FAIR"
          ],
          "path": [
            "condition"
          ],
          "message": "Invalid option: expected one of \"NEW\"|\"USED\"|\"FAIR\""
        }
      ]
          at createListing (/home/bytesage/campus-swap/backend/src/controllers/listingController.ts:21:51)
          at Layer.handleRequest (/home/bytesage/campus-swap/backend/node_modules/router/lib/layer.js:152:17)
          at next (/home/bytesage/campus-swap/backend/node_modules/router/lib/route.js:157:13)
          at multerMiddleware (/home/bytesage/campus-swap/backend/node_modules/multer/lib/make-middleware.js:19:41)
          at Layer.handleRequest (/home/bytesage/campus-swap/backend/node_modules/router/lib/layer.js:152:17)
          at next (/home/bytesage/campus-swap/backend/node_modules/router/lib/route.js:157:13)
          at protect (/home/bytesage/campus-swap/backend/src/routes/listingRoutes.ts:27:9)
          at Layer.handleRequest (/home/bytesage/campus-swap/backend/node_modules/router/lib/layer.js:152:17)
          at next (/home/bytesage/campus-swap/backend/node_modules/router/lib/route.js:157:13)
          at Route.dispatch (/home/bytesage/campus-swap/backend/node_modules/router/lib/route.js:117:3)
          at handle (/home/bytesage/campus-swap/backend/node_modules/router/index.js:435:11)
          at Layer.handleRequest (/home/bytesage/campus-swap/backend/node_modules/router/lib/layer.js:152:17)
          at /home/bytesage/campus-swap/backend/node_modules/router/index.js:295:15
          at processParams (/home/bytesage/campus-swap/backend/node_modules/router/index.js:582:12)
          at next (/home/bytesage/campus-swap/backend/node_modules/router/index.js:291:5)
          at Function.handle (/home/bytesage/campus-swap/backend/node_modules/router/index.js:186:3)
          at router (/home/bytesage/campus-swap/backend/node_modules/router/index.js:60:12)
          at Layer.handleRequest (/home/bytesage/campus-swap/backend/node_modules/router/lib/layer.js:152:17)
          at trimPrefix (/home/bytesage/campus-swap/backend/node_modules/router/index.js:342:13)
          at /home/bytesage/campus-swap/backend/node_modules/router/index.js:297:9
          at processParams (/home/bytesage/campus-swap/backend/node_modules/router/index.js:582:12)
          at next (/home/bytesage/campus-swap/backend/node_modules/router/index.js:291:5)
          at /home/bytesage/campus-swap/backend/node_modules/body-parser/lib/read.js:172:5
          at AsyncResource.runInAsyncScope (node:async_hooks:214:14)
          at invokeCallback (/home/bytesage/campus-swap/backend/node_modules/raw-body/index.js:238:16)
          at done (/home/bytesage/campus-swap/backend/node_modules/raw-body/index.js:227:7)
          at IncomingMessage.onEnd (/home/bytesage/campus-swap/backend/node_modules/raw-body/index.js:287:7)
          at IncomingMessage.emit (node:events:519:28)
          at endReadableNT (node:internal/streams/readable:1698:12)
          at processTicksAndRejections (node:internal/process/task_queues:90:21)

       5 |     error: (message: string, error?: any) => {
       6 |         console.error(`[ERROR] [${new Date().toISOString()}] ${message}`, error?.message || error || '');
    >  7 |         if (error?.stack) console.error(error.stack);
         |                                   ^
       8 |     },
       9 |     warn: (message: string, context?: any) => {
      10 |         console.warn(`[WARN] [${new Date().toISOString()}] ${message}`, context ? JSON.stringify(context, null, 2) : '');

      at Object.error (src/utils/logger.ts:7:35)
      at handleControllerError (src/controllers/listingController.ts:9:12)
      at createListing (src/controllers/listingController.ts:50:16)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at multerMiddleware (node_modules/multer/lib/make-middleware.js:19:41)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at protect (src/routes/listingRoutes.ts:27:9)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/body-parser/lib/read.js:172:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

    console.log
      [INFO] [2026-01-02T15:04:19.068Z] Listing Updated Successfully {
        "listingId": "a855c557-d40b-4ed2-8c59-8107c176ebbe"
      }

      at Object.info (src/utils/logger.ts:3:17)

    console.warn
      [WARN] [2026-01-02T15:04:19.088Z] Unauthorized update attempt {
        "listingId": "a855c557-d40b-4ed2-8c59-8107c176ebbe",
        "userId": "other-id"
      }

       8 |     },
       9 |     warn: (message: string, context?: any) => {
    > 10 |         console.warn(`[WARN] [${new Date().toISOString()}] ${message}`, context ? JSON.stringify(context, null, 2) : '');
         |                 ^
      11 |     }
      12 | };
      13 |

      at Object.warn (src/utils/logger.ts:10:17)
      at updateListing (src/controllers/listingController.ts:101:20)

    console.log
      [INFO] [2026-01-02T15:04:19.124Z] Listing Deleted Successfully {
        "listingId": "a855c557-d40b-4ed2-8c59-8107c176ebbe"
      }

      at Object.info (src/utils/logger.ts:3:17)

PASS tests/verification.test.ts
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (6) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      [dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      [INFO] [2026-01-02T15:04:19.797Z] ID Documents Uploaded {
        "userId": "478c4003-6d12-474b-abec-860c1049005a",
        "verificationId": "e0314faf-dcc4-49a5-9a87-69476c31808d"
      }

      at Object.info (src/utils/logger.ts:3:17)


Test Suites: 3 failed, 3 passed, 6 total
Tests:       12 failed, 23 passed, 35 total
Snapshots:   0 total
Time:        6.405 s, estimated 10 s
Ran all test suites.
